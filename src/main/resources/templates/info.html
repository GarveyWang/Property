<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="dashboard">

<head>
    <title>政策公告</title>
    <link href="../static/css/bootstrap/fileinput.min.css" rel="stylesheet">
</head>
<body>
<h2 layout:fragment="title">
    政策公告
</h2>
<div layout:fragment="content" style="width:90%;">
    <div class="form-horizontal">
        <h3  class="col-sm-offset-1" style="text-align: center"><b>发布公告</b></h3>
        <div class="form-group">
            <label for="infoTitle" class="col-sm-1 control-label">标题</label>
            <div class="col-sm-11">
                <input type="text" name="title" class="form-control" id="infoTitle" placeholder="请输入标题">
            </div>
        </div>
        <div class="form-group">
            <label for="infoContent" class="col-sm-1 control-label">内容</label>
            <div class="col-sm-11">
                <textarea rows="8" name="content" class="form-control" id="infoContent" placeholder="请输入内容"></textarea>
            </div>
        </div>
        <div class="form-group">
            <label for="attachments" class="col-sm-1 control-label">添加附件</label>
            <div class="col-sm-11 form-inline">
                <input id="attachments" multiple type="file" name="attachments" />
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-offset-10 col-sm-2">
                <a class="btn btn-default" href="/publicity/info">取消</a>
                <button class="btn btn-primary" onclick="submitInfo()">发布</button>
            </div>
        </div>
    </div>
</div>
<th:block layout:fragment="bottomScriptBlock">
    <script type="text/javascript" src="../static/js/bootstrap/fileinput.min.js"></script>
    <script type="text/javascript" src="../static/js/bootstrap/fileinput-locale-zh.js"></script>
    <script type="text/javascript">
        $(function () {
            $('.nav-item').children('ul').slideUp(300);
            $("#infoNav").slideDown(300);
            $("#infoNav").parent('li').addClass('nav-show').siblings('li').removeClass('nav-show');

            $("#attachments").fileinput({
                language: 'zh', //设置语言
                uploadUrl: "/publicity/uploadInfo", //上传的地址
                allowedFileExtensions: ['jpg', 'gif', 'png','doc','docx','pdf','ppt','pptx','txt','xls','xlsx'],//接收的文件后缀
                uploadAsync: false, //默认异步上传
                showUpload: false, //是否显示上传按钮
                showRemove : true, //显示移除按钮
                showPreview : true, //是否显示预览
                showCaption: false,//是否显示标题
                browseClass: "btn btn-primary", //按钮样式
                //dropZoneEnabled: true,//是否显示拖拽区域
                //minImageWidth: 50, //图片的最小宽度
                //minImageHeight: 50,//图片的最小高度
                //maxImageWidth: 1000,//图片的最大宽度
                //maxImageHeight: 1000,//图片的最大高度
                maxFileSize: 10000,//单位为kb，如果为0表示不限制文件大小
                //minFileCount: 0,
                //maxFileCount: 10, //表示允许同时上传的最大文件个数
                enctype: 'multipart/form-data',
                validateInitialCount:true,
                previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
                msgFilesTooMany: "选择上传的文件数量({n}) 超过允许的最大数值{m}！",
                layoutTemplates :{
                    // actionDelete:'', //去除上传预览的缩略图中的删除图标
                    actionUpload:'',//去除上传预览缩略图中的上传图片；
                    actionZoom:''   //去除上传预览缩略图中的查看详情预览的缩略图标。
                },
                uploadExtraData:function () {
                    return {
                        "title": $("#infoTitle").val(),
                        "content": $("#infoContent").val()
                    };
                }
            }).on("filebatchuploadsuccess", function (event, data, previewId, index) {
                alert('公告发布成功！');
                window.location.href="/publicity/info";
            }).on('filebatchuploaderror', function(event, data, msg) {
                alert('公告发布失败！');
            });


            var info = "[[${info}]]";
            if (info != null && info.length>0){
                alert(info);
            }
        });
        function submitInfo() {
            $("#attachments").fileinput("upload");
        }
    </script>
</th:block>
</body>
</html>